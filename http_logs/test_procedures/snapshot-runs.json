{
    "name": "restore-from-snapshot",
    "schedule": [
    {
      "operation": "delete-index"
    },
    {
      "name": "register-snapshot-repository",
      "operation": {
        "operation-type": "create-snapshot-repository",
        "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
        "body": {
          "type": "s3",
          "settings": {
          "bucket": {{ snapshot_bucket_name | default('test-snapshot-bucket') | tojson }},
          "region": {{ snapshot_region | default('us-east-1') | tojson }},
          "base_path": {{ snapshot_base_path | default('test-base-path') | tojson }}
          }
        }
      }
    },
    {
      "name": "restore-from-snapshot",
      "operation": {
        "operation-type": "restore-snapshot",
        "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
        "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
        "body": {
          "index_settings": {
            "index.number_of_replicas": {{ number_of_replicas | default(0) }}
          }
        },
        "wait-for-completion": false
      }
    },
    {
      "name": "wait-for-snapshot-recovery",
      "operation": {
        "operation-type": "wait-for-recovery",
        "index": "logs-*"
      }
    },
    {
      "name": "refresh-after-index",
      "operation": "refresh"
    },
    {
      "operation": {
        "operation-type": "force-merge",
        "request-timeout": 7200
      }
    },
    {
      "name": "refresh-after-force-merge",
      "operation": "refresh"
    },
    {
      "name": "check-cluster-health",
      "operation": {
        "operation-type": "cluster-health",
        "index": "logs-*",
        "request-params": {
          "wait_for_status": "{{cluster_health | default('green')}}",
          "wait_for_no_relocating_shards": "true"
        },
        "retry-until-success": true
      }
    },
    {
      "operation": "default",
      "warmup-iterations": 500,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 8
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "name": "term",
      "operation": "term",
      "warmup-iterations": 500,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 50
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "range",
      "warmup-iterations": 100,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "200s-in-range",
      "warmup-iterations": 500,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 33
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "400s-in-range",
      "warmup-iterations": 500,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 50
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "hourly_agg",
      "warmup-iterations": 50,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "multi_term_agg",
      "warmup-iterations": 50,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "scroll",
      "warmup-iterations": 100,
      "iterations": 200,
      "#COMMENT": "Throughput is considered per request. So we issue one scroll request per second which will retrieve 25 pages",
      "target-throughput": 1
    },
    {
      "operation": "desc_sort_size",
      "warmup-iterations": 200,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "asc_sort_size",
      "warmup-iterations": 200,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "desc_sort_timestamp",
      "warmup-iterations": 200,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "asc_sort_timestamp",
      "warmup-iterations": 200,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "desc_sort_with_after_timestamp",
      "warmup-iterations": 10,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
      "operation": "asc_sort_with_after_timestamp",
      "warmup-iterations": 10,
      "iterations": 100
      {%- if not target_throughput %}
      ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
      ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
      ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
          "operation": "range_size",
          "warmup-iterations": {{ range_size_warmup_iterations or warmup_iterations | default(100) | tojson }},
          "iterations": {{ range_size_iterations or iterations | default(100) | tojson }},
          "target-throughput": {{ range_size_target_throughput or target_throughput | default(2) | tojson }},
          "clients": {{ range_size_search_clients or search_clients | default(1) }}
    },
    {
          "operation": "range_with_asc_sort",
          "warmup-iterations": {{ range_with_asc_sort_warmup_iterations or warmup_iterations | default(100) | tojson }},
          "iterations": {{ range_with_asc_sort_iterations or iterations | default(100) | tojson }},
          "target-throughput": {{ range_with_asc_sort_target_throughput or target_throughput | default(2) | tojson }},
          "clients": {{ range_with_asc_sort_search_clients or search_clients | default(1) }}
    },
    {
          "operation": "range_with_desc_sort",
          "warmup-iterations": {{ range_with_asc_sort_warmup_iterations or warmup_iterations | default(100) | tojson }},
          "iterations": {{ range_with_asc_sort_iterations or iterations | default(100) | tojson }},
          "target-throughput": {{ range_with_asc_sort_target_throughput or target_throughput | default(2) | tojson }},
          "clients": {{ range_with_asc_sort_search_clients or search_clients | default(1) }}
    }
    ]
  }
