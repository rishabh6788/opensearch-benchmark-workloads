{
    "name": "restore-from-snapshot",
    "schedule": [
      {
        "operation": "delete-index"
      },
      {
        "name": "register-snapshot-repository",
        "operation": {
          "operation-type": "create-snapshot-repository",
          "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
          "body": {
            "type": "s3",
            "settings": {
            "bucket": {{ snapshot_bucket_name | default('test-snapshot-bucket') | tojson }},
            "region": {{ snapshot_region | default('us-east-1') | tojson }},
            "base_path": {{ snapshot_base_path | default('test-base-path') | tojson }}
            }
          }
        }
      },
      {
        "name": "restore-from-snapshot",
        "operation": {
          "operation-type": "restore-snapshot",
          "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
          "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
            "body": {
            "index_settings": {
              "index.number_of_replicas": {{ number_of_replicas | default(0) }}
            }
          },
          "wait-for-completion": false
        }
      },
      {
        "name": "wait-for-snapshot-recovery",
        "operation": {
          "operation-type": "wait-for-recovery",
          "index": "nyc_taxis"
        }
      },
      {
        "name": "check-cluster-health",
        "operation": {
          "operation-type": "cluster-health",
          "index": "nyc_taxis*",
          "request-params": {
            "wait_for_status": "{{cluster_health | default('green')}}",
            "wait_for_no_relocating_shards": "true"
          },
          "retry-until-success": true
        }
      },
      {
        "operation": "default",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 3
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "range",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 1
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "distance_amount_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 2
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "autohisto_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 1.5
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "date_histogram_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 1.5
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "desc_sort_tip_amount",
        "warmup-iterations": 50,
        "iterations": 100
      {%- if not target_throughput %}
    ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
    ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
    ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
        "operation": "asc_sort_tip_amount",
        "warmup-iterations": 50,
        "iterations": 100
      {%- if not target_throughput %}
    ,"target-throughput": 1
      {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
      {%- else %}
    ,"target-throughput": {{ target_throughput | tojson }}
      {%- endif %}
      {%-if search_clients is defined and search_clients %}
    ,"clients": {{ search_clients | tojson}}
      {%- endif %}
    },
    {
          "operation": "desc_sort_passenger_count",
          "warmup-iterations": {{ desc_sort_passenger_count_warmup_iterations or warmup_iterations | default(50) | tojson }},
          "iterations": {{ desc_sort_passenger_count_iterations or iterations | default(100) | tojson }},
          "target-throughput": {{ desc_sort_passenger_count_target_throughput or target_throughput | default(2) | tojson }},
          "clients": {{ desc_sort_passenger_count_search_clients or search_clients | default(1) }}
    },
    {
          "operation": "asc_sort_passenger_count",
          "warmup-iterations": {{ asc_sort_passenger_count_warmup_iterations or warmup_iterations | default(50) | tojson }},
          "iterations": {{ asc_sort_passenger_count_iterations or iterations | default(100) | tojson }},
          "target-throughput": {{ asc_sort_passenger_count_target_throughput or target_throughput | default(2) | tojson }},
          "clients": {{ asc_sort_passenger_count_search_clients or search_clients | default(1) }}
    }
    ]
  },
  {
    "name": "restore-from-snapshot-2-shards",
    "schedule": [
      {
        "operation": "delete-index"
      },
      {
        "name": "register-snapshot-repository",
        "operation": {
          "operation-type": "create-snapshot-repository",
          "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
          "body": {
            "type": "s3",
            "settings": {
            "bucket": {{ snapshot_bucket_name | default('test-snapshot-bucket') | tojson }},
            "region": {{ snapshot_region | default('us-east-1') | tojson }},
            "base_path": {{ snapshot_base_path | default('test-base-path') | tojson }}
            }
          }
        }
      },
      {
        "parallel": {
          "tasks": [
            {
              "name": "restore-from-snapshot-1",
              "operation": {
                "operation-type": "restore-snapshot",
                "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
                "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
                "body": {
                  "indices": "nyc_taxis",
                  "rename_pattern": "nyc_taxis",
                  "rename_replacement": "nyc_taxis_1"
                },
                "wait-for-completion": false
              }
            },
            {
              "name": "restore-from-snapshot-2",
              "operation": {
                "operation-type": "restore-snapshot",
                "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
                "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
                "body": {
                  "indices": "nyc_taxis",
                  "rename_pattern": "nyc_taxis",
                  "rename_replacement": "nyc_taxis_2"
                },
                "wait-for-completion": false
              }
            }
          ]
        }
      },
      {
        "name": "wait-for-snapshot-recovery",
        "operation": {
          "operation-type": "wait-for-recovery",
          "index": "nyc_taxis*"
        }
      },
      {
        "name": "check-cluster-health",
        "operation": {
          "operation-type": "cluster-health",
          "index": "nyc_taxis*",
          "request-params": {
            "wait_for_status": "{{cluster_health | default('green')}}",
            "wait_for_no_relocating_shards": "true"
          },
          "retry-until-success": true
        }
      },
      {
        "operation": "default",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 3
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "range",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 0.7
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "distance_amount_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 2
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "autohisto_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 1.5
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "date_histogram_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 1.5
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
{
"operation": "desc_sort_tip_amount",
"warmup-iterations": 50,
"iterations": 100
{%- if not target_throughput %}
,"target-throughput": 0.5
{%- elif target_throughput is string and target_throughput.lower() == 'none' %}
{%- else %}
,"target-throughput": {{ target_throughput | tojson }}
{%- endif %}
{%-if search_clients is defined and search_clients %}
,"clients": {{ search_clients | tojson}}
{%- endif %}
},
{
"operation": "asc_sort_tip_amount",
"warmup-iterations": 50,
"iterations": 100
{%- if not target_throughput %}
,"target-throughput": 0.5
{%- elif target_throughput is string and target_throughput.lower() == 'none' %}
{%- else %}
,"target-throughput": {{ target_throughput | tojson }}
{%- endif %}
{%-if search_clients is defined and search_clients %}
,"clients": {{ search_clients | tojson}}
{%- endif %}
}
    ]
  },
  {
    "name": "restore-from-snapshot-5-shards",
    "schedule": [
      {
        "operation": "delete-index"
      },
      {
        "name": "register-snapshot-repository",
        "operation": {
          "operation-type": "create-snapshot-repository",
          "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
          "body": {
            "type": "s3",
            "settings": {
            "bucket": {{ snapshot_bucket_name | default('test-snapshot-bucket') | tojson }},
            "region": {{ snapshot_region | default('us-east-1') | tojson }},
            "base_path": {{ snapshot_base_path | default('test-base-path') | tojson }}
            }
          }
        }
      },
      {
        "parallel": {
          "tasks": [
            {
              "name": "restore-from-snapshot-1",
              "operation": {
                "operation-type": "restore-snapshot",
                "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
                "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
                "body": {
                  "indices": "nyc_taxis",
                  "rename_pattern": "nyc_taxis",
                  "rename_replacement": "nyc_taxis_1"
                },
                "wait-for-completion": false
              }
            },
            {
              "name": "restore-from-snapshot-2",
              "operation": {
                "operation-type": "restore-snapshot",
                "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
                "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
                "body": {
                  "indices": "nyc_taxis",
                  "rename_pattern": "nyc_taxis",
                  "rename_replacement": "nyc_taxis_2"
                },
                "wait-for-completion": false
              }
            },
            {
              "name": "restore-from-snapshot-3",
              "operation": {
                "operation-type": "restore-snapshot",
                "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
                "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
                "body": {
                  "indices": "nyc_taxis",
                  "rename_pattern": "nyc_taxis",
                  "rename_replacement": "nyc_taxis_3"
                },
                "wait-for-completion": false
              }
            },
            {
              "name": "restore-from-snapshot-4",
              "operation": {
                "operation-type": "restore-snapshot",
                "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
                "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
                "body": {
                  "indices": "nyc_taxis",
                  "rename_pattern": "nyc_taxis",
                  "rename_replacement": "nyc_taxis_4"
                },
                "wait-for-completion": false
              }
            },
            {
              "name": "restore-from-snapshot-5",
              "operation": {
                "operation-type": "restore-snapshot",
                "repository": {{ snapshot_repo_name | default('test-snapshot-repo') | tojson }},
                "snapshot": {{ snapshot_name | default('test-snapshot') | tojson }},
                "body": {
                  "indices": "nyc_taxis",
                  "rename_pattern": "nyc_taxis",
                  "rename_replacement": "nyc_taxis_5"
                },
                "wait-for-completion": false
              }
            }
          ]
        }
      },
      {
        "name": "wait-for-snapshot-recovery",
        "operation": {
          "operation-type": "wait-for-recovery",
          "index": "nyc_taxis*"
        }
      },
      {
        "name": "check-cluster-health",
        "operation": {
          "operation-type": "cluster-health",
          "index": "nyc_taxis*",
          "request-params": {
            "wait_for_status": "{{cluster_health | default('green')}}",
            "wait_for_no_relocating_shards": "true"
          },
          "retry-until-success": true
        }
      },
      {
        "operation": "default",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 3
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "range",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 0.7
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "distance_amount_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 2
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "autohisto_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 1.5
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
      {
        "operation": "date_histogram_agg",
        "warmup-iterations": 50,
        "iterations": 100
        {%- if not target_throughput %}
        ,"target-throughput": 1.5
        {%- elif target_throughput is string and target_throughput.lower() == 'none' %}
        {%- else %}
        ,"target-throughput": {{ target_throughput | tojson }}
        {%- endif %}
        {%-if search_clients is defined and search_clients %}
        ,"clients": {{ search_clients | tojson}}
        {%- endif %}
      },
{
"operation": "desc_sort_tip_amount",
"warmup-iterations": 50,
"iterations": 100
{%- if not target_throughput %}
,"target-throughput": 0.5
{%- elif target_throughput is string and target_throughput.lower() == 'none' %}
{%- else %}
,"target-throughput": {{ target_throughput | tojson }}
{%- endif %}
{%-if search_clients is defined and search_clients %}
,"clients": {{ search_clients | tojson}}
{%- endif %}
},
{
"operation": "asc_sort_tip_amount",
"warmup-iterations": 50,
"iterations": 100
{%- if not target_throughput %}
,"target-throughput": 0.5
{%- elif target_throughput is string and target_throughput.lower() == 'none' %}
{%- else %}
,"target-throughput": {{ target_throughput | tojson }}
{%- endif %}
{%-if search_clients is defined and search_clients %}
,"clients": {{ search_clients | tojson}}
{%- endif %}
}
    ]
  }
